(function(a){a(function(){var b={};b.getRecords=function(){a("#noRecords").hide();a.ajax({type:"GET",url:b.target,data:"loadTable=true",success:function(c){if(c=="none"){a("#noRecords").show()}else{a("#recordsTable").append(c)}},error:b.displayErrors})};b.addRecord=function(){a("div#errors").children().remove();a("#actionType").val("add");a("#recordsForm").ajaxSubmit({url:b.target,type:"POST",dataType:"html",success:function(c){a("tbody").prepend(c);a("tbody :first").show("explode");a("#recordsForm").resetForm()},error:b.displayErrors})};b.deleteRecord=function(c){a.ajax({type:"POST",url:b.target,data:{actionType:"delete",id:c},success:function(){a("tr[data-id="+c+"]").hide("explode",function(){a(this).remove()})},error:b.displayErrors})};b.editRecord=function(){a("div#errors").children().remove();a("#actionType").val("edit");a("#recordsForm").ajaxSubmit({url:b.target,type:"POST",dataType:"html",success:function(d){var c=a(d).attr("data-id");a("tr[data-id="+c+"]").remove();a("tbody").prepend(d);a("tbody :first").show("explode");a("#recordsForm").resetForm();b.restore()},error:b.displayErrors})};b.displayErrors=function(c){a("#errors").append("<p>"+c.responseText+"</p>")};b.restore=function(){a("#edit-button").hide();a("#add-button").fadeIn("fast");a("#caption").html("Add a new member");a("form").find(".error").removeClass("error");a("label[generated]").remove();a("#username").rules("add",{remote:{url:b.target,type:"GET",data:{username:function(){return a(":input[name=username]").val()}}},messages:{remote:"Username exists"}});a("#password").rules("add",{required:true,messages:{required:"Password required"}})};a(".delete").live("click",function(){a("#modal-delete-confirm").modal("show");var d=a(this).closest("tr[data-id]").attr("data-id");var c=a(this).parent().siblings(".username").text();a("#modal-user").html(c);a("#modal-delete").data("id",d);a("div#errors").children().remove()});a("#modal-delete").click(function(){b.deleteRecord(a(this).data("id"));a("#modal-delete-confirm").modal("hide");b.restore();a("#recordsForm").resetForm()});a(".edit").live("click",function(){a(this).parent().siblings("[class]").each(function(){var d=a(this).attr("class");var e=a(this).text();a(".formInputs").each(function(){if(a(this).attr("name")==d){a(this).val(e)}})});a("form").find(".error").removeClass("error");a("label[generated]").remove();var c=a(this).closest("tr[data-id]").attr("data-id");a("#recordId").val(c);a("#add-button").hide();a("#edit-button").fadeIn("fast");a("#caption").html("Edit member");a("#username").rules("remove","remote");a("#password").rules("remove","required")});a("#add-button").click(function(){if(a("#recordsForm").valid()){b.addRecord()}});a("#edit-button").click(function(){if(a("#recordsForm").valid()){b.editRecord()}});a("#cancel-button").click(function(){a("#recordsForm").resetForm();b.restore()});a("#modal-cancel").click(function(){a("#modal-delete-confirm").modal("hide")});b.target=a("#recordsForm").attr("action");a("#recordsForm").ajaxForm();b.getRecords();a("#modal-delete-confirm").modal({backdrop:true,keyboard:true});a("#recordsForm").validate({rules:{username:{required:true},confirm_password:{equalTo:"#password"},fname:"required",lname:"required"},messages:{username:{required:"Username required"},confirm_password:{equalTo:"Passwords do not match"},fname:{required:"First name required"},lname:{required:"Last name required"}}});b.restore()})}(jQuery));